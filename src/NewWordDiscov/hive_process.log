hive> 
    > 
    > create external table if not exists nw_word_entropy(
    > word string,
    > entropy float,
    > type string
    > )
    > PARTITIONED BY (ds string)
    > ROW FORMAT DELIMITED
    > FIELDS TERMINATED BY '\t'
    > LINES TERMINATED BY '10'
    > STORED AS TEXTFILE;
hive> alter table nw_word_entropy drop if exists partition(ds='2016-11-06');
hive> insert overwrite  table nw_word_entropy partition(ds='2016-11-06') 
    > select t12.word, -1.0 * sum(t12.logp),  t12.type
    > from
    > (
    >     select t1.word, t1.type, (log(1.0 * t1.count / t2.total ) * t1.count / t2.total) as logp from
    >     (
    >         select word, 'r' as type,  count from nw_word_co_count where(ds = '2016-11-06' and type =  'r')
    >         union all 
    >         select co_word as word,  'l' as type, count from nw_word_co_count where (ds='2016-11-06' and  type = 'r')
    >     )t1
    >     join
    >     (
    >         select word, 'r' as type, sum(count) as total from nw_word_co_count where(ds='2016-11-06' and  type = 'r') group by word
    >         union all 
    >         select co_word as word, 'l' as type, sum(count) as total from nw_word_co_count where(ds='2016-11-06' and type = 'r') group by co_word
    >     )t2
    >     on
    >     (t1.word = t2.word and t1.type = t2.type)
    > )t12  group by t12.word, t12.type;
